# 10/25

# [ëª©ì°¨]ğŸ“

[1. [M:N]](#mn)

[2. íŒ”ë¡œì‰ ê¸°ëŠ¥êµ¬í˜„ ì´ë¡ ](#íŒ”ë¡œì‰-ê¸°ëŠ¥êµ¬í˜„-ì´ë¡ )

[3. íŒ”ë¡œì‰ ê¸°ëŠ¥êµ¬í˜„ ì‹¤ìŠµ](#íŒ”ë¡œì‰-ê¸°ëŠ¥êµ¬í˜„-ì´ë¡ )

<br>

## M:N

- ManyToManyField
- ì—°ê´€ìˆëŠ” ëª¨ë¸ì„ ì—°ê²°
- ì¬ê·€ì ì¸ selfë¥¼ ì‚¬ìš©
- MTM FieldëŠ” symmetrical(ëŒ€ì¹­)ì¼ ê²ƒì„ ê°€ì •

```py
class User(AbstractUser):
  # Aê°€ Bë¥¼ íŒ”ë¡œì‰, ì´ ê²ƒì€ ì„œë¡œ ì¹œêµ¬ X(symmetrical=False)
  followings = models.ManyToManyField('self', symmetrical=False, related_name = 'followers')

# íŒ”ë¡œì‰ ê¸°ëŠ¥ êµ¬í˜„

ì‚¬ìš©ì í”„ë¡œí•„ í˜ì´ì§€ì— ë“¤ì–´ê°€ì„œ
íŒ”ë¡œìš° ìƒíƒœê°€ ì•„ë‹ˆë©´ 'íŒ”ë¡œìš°'ë¥¼ ëˆ„ë¥´ë©´ ì¶”ê°€(add)
íŒ”ë¡œìš° ìƒíƒœì´ë©´, 'íŒ”ë¡œìš° ì·¨ì†Œ'ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‚­ì œ(remove)

íŒ”ë¡œìš°/ì·¨ì†Œ ìš”ì²­ì„ í•  ë•Œ URLì€ ì–´ë–»ê²Œí• ê¹Œ?
/accounts/<int:pk>/follow/
ì²˜ë¦¬ ì™„ë£Œ í›„ì—ëŠ” í”„ë¡œí•„ í˜ì´ì§€ë¡œ redirect

(ì¶”ê°€ì‚¬í•­)
ì…€í”„ ì¢‹ì•„ìš”ëŠ” í—ˆìš©ì´ì§€ë§Œ
ì…€í”„ íŒ”ë¡œìš°ëŠ” í—ˆìš©í•  ìˆ˜ ì—†ë‹¤.
```

## íŒ”ë¡œì‰ ê¸°ëŠ¥êµ¬í˜„ ì´ë¡ 

```py
# accounts/ urls.py
path('<int:pk>/follow/', views.follow, name="follow")

# detail.html
a ë§í¬ {% url 'accounts:detail' user.pk %} íŒ”ë¡œìš°
# view.py
@login_required
def follow(request, pk):
  User == get_user_model() # get_user_model ì‚¬ìš©í•˜ê¸°
  user = get_user_model().objects.get(pk=pk)
  if request.user == user:
    messages.warning(request, 'ìŠ¤ìŠ¤ë¡œ íŒ”ë¡œìš° í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
    return redirect('accounts:detail', pk)

  if request.user in user.followers.all() # ìˆìœ¼ë©´ ì‚­ì œ
    user.followers.remove(request.user)
  # íŒ”ë¡œìš° ìƒíƒœì´ë©´, 'íŒ”ë¡œìš° ì·¨ì†Œ'ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‚­ì œ(remove)
  else: # ì—†ìœ¼ë©´ ì¶”ê°€
  # íŒ”ë¡œìš° ìƒíƒœê°€ ì•„ë‹ˆë©´ 'íŒ”ë¡œìš°'ë¥¼ ëˆ„ë¥´ë©´ ì¶”ê°€(add)
    user.followers.add(request.user)

  return redirect('accounts:detail', pk)

# ì—ëŸ¬ ë„ìš°ê¸°
# getì€ ì—†ì„ë•Œ ì˜¤ë¥˜ë¥¼ ë‚´ì£¼ê¸° ë•Œë¬¸ì— get_object_or_404ë¥¼ ì‚¬ìš©í•´ì•¼í•¨
article = get_object_or_404(Article, pk=pk)
```
<br>


## íŒ”ë¡œì‰ ê¸°ëŠ¥êµ¬í˜„ ì‹¤ìŠµ

![](2022-10-25.gif)
```py
1. model
Userëª¨ë¸ì—ì„œ followings = models.ManyToManyField('self', symmetrical=False, related_name = 'followers')ë¡œ ë³€ê²½

2. url.py
urls.pyì—ì„œ path('<int:pk>/follow/', views.follow, name='follow')ë¡œ variable routing ì„¤ì •

3. views.py
def follow(request, pk):
  user = get_object_or_404(get_user_model(), pk=pk)
  if request.user == user:
    messages.warning(request, "ìŠ¤ìŠ¤ë¡œ íŒ”ë¡œìš° í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    return redirect('accounts:detail')

  if request.user in user.followers.all():
    user.followers.remove(request.user)
  else:
    user.followers.add(request.user)
ë¡œ í•¨ìˆ˜ë¥¼ ì •ì˜í•´ì„œ ë¡œê·¸ì¸í•œ ìœ ì €ì™€ íŒ”ë¡œìš° ë²„íŠ¼ì„ ëˆ„ë¥¸ ìœ ì €ê°€ ê°™ë‹¤ë©´ ê²½ê³ ì°½ì„, ë‹¤ë¥´ê³  DBì— ì—†ë‹¤ë©´ request.userë¥¼ DBì— ì¶”ê°€, request.userê°€ DBì— ìˆë‹¤ë©´ ì‚­ì œí•˜ë„ë¡ êµ¬í˜„

4. HTML

4-1 ìˆ«ì
{% user.followings.count %}
{% user.followers.count %} ë¡œ íŒ”ë¡œì‰ê³¼ íŒ”ë¡œì›Œ ìˆ«ìë¥¼ countí•˜ê³ 
{% if request.user != user %}ê°€ ë‹¤ë¥´ë‹¤ë©´
{% url 'account:follow' user.pk %}ë¥¼ ì „ì†¡í•˜ëŠ” aíƒœê·¸
{% if reuqest.user in user.followers.all %}ì— userê°€ ìˆë‹¤ë©´
íŒ”ë¡œìš° ì·¨ì†Œë¥¼ ë³´ì—¬ì£¼ê³  ì—†ìœ¼ë©´ íŒ”ë¡œìš°ê°€ ë³´ì´ê²Œë” ì„¤ì •

4-2 ëª©ë¡
# views.py
def detail(request,pk):
  user = get_user_model().object.get(pk=pk)
  # user = get_object_or_404(get_user_model(), pk=pk) ê°€ ë” ë°”ëŒì§
  indexs = user.followers.all()
  followings = user.followings.all()
# detial.html
{% for index in indexs.all %} {{ index.username }} {% endfor %}
ë¡œ user.usernameì„ íŒ”ë¡œìš° í•˜ëŠ” ëª…ë‹¨ì„ ì¶œë ¥
{% for following in followings.all %} {{ following.username }} {% endfor %}
ë¡œ user.usernameì´ íŒ”ë¡œìš°í•˜ê³  ìˆëŠ” ì‚¬ëŒì„ ì¶œë ¥
```