# 10/24

# [ëª©ì°¨]ğŸ“

[1. [Many to many relationship]](#many-to-many-relationship)

[2. ì¢‹ì•„ìš” ê¸°ëŠ¥êµ¬í˜„ ì´ë¡ ](#ì¢‹ì•„ìš”-ê¸°ëŠ¥êµ¬í˜„-ì´ë¡ )

[3. ì¢‹ì•„ìš” ê¸°ëŠ¥êµ¬í˜„ ì‹¤ìŠµ](#ì¢‹ì•„ìš”-ê¸°ëŠ¥êµ¬í˜„-ì‹¤ìŠµ)

<br>

## Many to many relationship

- N:1ì—ëŠ” í•œê³„ê°€ ì¡´ì¬í•¨
- ì¤‘ìš”í•œ ì„œë¹„ìŠ¤ì˜ ë¶€ë¶„ë“¤ì€ M:Nì˜ ê´€ê³„
- ë™ì¼í•œ í™˜ìì´ì§€ë§Œ ê°™ì€ ì˜ì‚¬ì—ê²Œ ì˜ˆì•½í•˜ë ¤ë©´ ê°ì²´ë¥¼ 2ê°œ ìƒì„±í•´ì•¼í•¨.
- ìƒˆë¡œìš´ ëª¨ë¸ì„ í†µí•´ M:N ê´€ê³„ ì •ì˜
- **MTM í•„ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì¤‘ê°œ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ì‚¬ìš©í•¨**
- ìƒˆë¡œìš´ ìƒì„¸ ë‚´ì—­ì„ ë„£ê¸° ìœ„í•´ì„œëŠ” through = 'class' ë¥¼ ë„£ì–´ì£¼ë©´ ë¨

```py
class Patient(models.Model):
  # ManyToManyField
  doctors = models.ManyToManyField(Dortor)
  name = models.TextField()

# ì¡°íšŒ
patient1.doctiors.add(doctor1)
# ì˜ì‚¬ì˜ ì˜ˆì•½ í™˜ì ëª©ë¡ í™•ì¸
dortor1.patient_set.all()
# ì˜ˆì•½ ì·¨ì†Œ
dortor1.patient_set.remove(patient1)
```

- ì¡°íšŒë¥¼ ì‰½ê²Œ í•˜ê¸°

```py
# ì—­ì°¸ì¡°ë¥¼ ì–´ë–»ê²Œí• ì§€ ë„¤ì´ë°
# ForeignKey()ì˜ related_nameê³¼ ë™ì¼
related_name = patients

```

- ì •ë¦¬

```py
M:N ê´€ê³„ë¡œ ë§ºì–´ì§„ ë‘ í…Œì´ë¸”ì—ëŠ” ë³€í™”ê°€ ì—†ìŒ
Django ManyToManyFieldëŠ” ì¤‘ê°œ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±
Django ManyToManyFieldëŠ” M:N ê´€ê³„ë¥¼ ê°€ì§„ ëª¨ë¸ ì–´ë””ì— ìœ„ì¹˜í•´ë„ ìƒê´€ì—†ìŒ
```

<br>

### ì¢‹ì•„ìš” ê¸°ëŠ¥êµ¬í˜„ ì´ë¡ 

- DB ì¢‹ì•„ìš”ë¥¼ ì–´ë–»ê²Œ ê¸°ë¡í•  ê²ƒì¸ì§€ ìƒê°
- Article(M) - User(N)
- Articleì€ 0ëª… ì´ìƒì˜ Userì—ê²Œ ì¢‹ì•„ìš”ë¥¼ ë°›ëŠ”ë‹¤.
- UserëŠ” 0ê°œ ì´ìƒì˜ ê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆë‹¤.

```py
# ë¡œì§
ìƒì„¸ë³´ê¸° í˜ì´ì§€ì—ì„œ ì¢‹ì•„ìš” ë§í¬ë¥¼ ëˆ„ë¥´ë©´,
URL: /articles/<int:pk>/like/
ì¢‹ì•„ìš”ë¥¼ DBì— ì¶”ê°€í•˜ê³  ë‹¤ì‹œ ìƒì„¸ë³´ê¸° í˜ì´ì§€ë¡œ redirect!

# ì—­ì°¸ì¡°ë¥¼ í•  ë•Œ ê²¹ì¹  ìˆ˜ ìˆìœ¼ë‹ˆ related_nameì„ ì„¤ì •í•˜ë©´ ì¢‹ìŒ
like_users = models.ManyToManyField(settings.AUTH_USER_MODEL, related_name="like_articles")

article.like_users.all() # ê²Œì‹œê¸€ì— ì¢‹ì•„ìš” ëˆ„ë¥¸ ëª¨ë“  ìœ ì €
user.like_articles.all() # ì‚¬ìš©ìê°€ ëˆ„ë¥¸ ëª¨ë“  ê¸€ë“¤
```

- ursl.py

```py
# variable routing
urlpatterns = [
  path('<int:pk>/like/', views.like, name="like"),
]
```

- views.py

```py
def like(request, pk):
  article = Article.objects.get(pk=pk)
  # ë§Œì•½ì— ë¡œê·¸ì¸í•œ ìœ ì €ê°€ ì´ ê¸€ì„ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ë‹¤ë©´,
  # if article.like_users.filter(id=request.user.id).exists()
  if request.user in article.like_users.all():
    # ì¢‹ì•„ìš” ì‚­ì œí•˜ê³ 
    article.like_users.remove(request.user)
  else:
    # ì¢‹ì•„ìš” ì¶”ê°€í•˜ê³ 
    article.like_users.add(request.user)
  # ìƒì„¸ í˜ì´ì§€ë¡œ redirect
  return redirect('article:detail', pk)
```

- detail.html

```py
{% if request.user.is_authenticated %}
<a href="{% url 'articles:like' article.pk %}">
  {% if request.user in article.like_users.all %} # articleì— ì¢‹ì•„ìš” ëˆ„ë¥¸ ìœ ì €ë“¤ì¤‘ request.userê°€ ìˆë‹¤ë©´
    # ë¡œì§
  {% else %}
    # ë¡œì§
  {% endif %}
{% endif %}
```

### ì¢‹ì•„ìš” ê¸°ëŠ¥êµ¬í˜„ ì‹¤ìŠµ

![](%EC%A2%8B%EC%95%84%EC%9A%94%EA%B8%B0%EB%8A%A5.gif)
```py
1. model
ëª¨ë¸ì—ì„œ like_userë¥¼ ì¶”ê°€í•˜ë©´ì„œ ManyToManyFieldë¥¼ ì¶”ê°€
2. url.py
urls.pyì—ì„œ <int:pk>/like ë¡œ variable routing ì„¤ì •
3. views.py
article = Article.objects.get(pk=pk)
if request.user in article.like_user.all():
  article.like_user.remove(request.user)
else:
  article.lise_user.add(reuqest.user)
return redirect("articles:detail", pk)
ë¡œ í•¨ìˆ˜ë¥¼ ì •ì˜í•´ì„œ modelì—ì„œ ì„¤ì •í•œ article.like_userì— ìš”ì²­ëœ request.userê°€ ìˆìœ¼ë©´ ë²„íŠ¼ëˆŒë €ì„ë•Œ DBë¥¼ ì‚­ì œí•˜ê³ , ì—†ë‹¤ë©´ ìƒˆë¡­ê²Œ DBë¥¼ ìƒì„±í•˜ë„ë¡ ë¡œì§ êµ¬í˜„
4. HTML
{% if request.user.is_authenticated %}
  {% if request.user in article.like_user.all %}
  {% url 'articles:like' article.pk %}ì¢‹ì•„ìš”ì·¨ì†Œ
  {% else %}
  {% url 'articles:like' article.pk %}ì¢‹ì•„ìš”
{% endif %} {{article.like_user.count }}
ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•˜ë¯€ë¡œì¨ ìš”ì²­ëœ request.userê°€ DBì— ìˆìœ¼ë©´ ì¢‹ì•„ìš” ì·¨ì†Œë¥¼ ë³´ì—¬ì£¼ê³  ì—†ìœ¼ë©´ ì¢‹ì•„ìš”ë¥¼ ë³´ì—¬ì¤Œ. article.like_user.countë¥¼ í†µí•´ì„œ ì¢‹ì•„ìš” ê°¯ìˆ˜ë¥¼ ì¶œë ¥
```
![](%EA%B2%8C%EC%8B%9C%EA%B8%80%EC%A2%8B%EC%95%84%EC%9A%94.gif)