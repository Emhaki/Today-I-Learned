# 10/19

# [ëª©ì°¨]ğŸ“

[1. [1:N ê´€ê³„ì„¤ì •]](#rdb)

[2. commentê¸°ëŠ¥ ì •ë¦¬](#commentê¸°ëŠ¥-ì •ë¦¬)

[3. comment ì‚­ì œ ê¸°ëŠ¥ ì •ë¦¬](#comment-ì‚­ì œ-ê¸°ëŠ¥-ì •ë¦¬)

<br>

## 1:N ê´€ê³„ì„¤ì •

- ë¡œê·¸ì¸í•˜ê³  ê¸€ì„ ì“°ë©´ ì‘ì„±ìê°€ ëˆ„êµ¬ì¸ì§€ ë³´ì—¬ì£¼ê²Œë”
- ForeignKey ë¥¼ í†µí•´ User_idë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í•˜ëŠ”ë° modelì— ì •ì˜ê°€ ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ modelì˜ ì¬ì •ì˜ê°€ í•„ìš”í•¨(DBë³€ê²½ì´ í•„ìš”í•¨)
- ìˆœì„œ: DB ì €ì¥ -> view ìˆ˜ì • -> Templates ìˆ˜ì •

```py
# models.py
user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
# on_deleteëŠ” ì•„ì´ë”” ì‚­ì œ ì‹œ ê²Œì‹œê¸€ ì‚­ì œ
```

- ìœ ì € ì •ë³´ë¥¼ ë„£ëŠ” ë°©ë²•

```py
views.py í•¨ìˆ˜ ì •ì˜ëœ ê³³ì—ì„œ ë‚´ê°€ ì‚¬ìš©ìë¡œë¶€í„° ìš”ì²­ ë°›ì„ ìˆ˜ ìˆëŠ” ì •ë³´ëŠ”?
- request.POST / request.GET
- URL(variable routing)

- request => Form: Formì—ì„œ ì…ë ¥í•œ ì •ë³´
- URL => ë‚´ê°€ ì„¤ì •í•œ ê¸¸: ê²Œì‹œê¸€ ë³´ê¸°(ë²„íŠ¼ ëˆ„ë¥´ë©´ ë‚´ê°€ URLì— ê°’ ë„£ì–´ë†“ìŒ)
```

- ìœ ì €ê°€ ì‘ì„±í•œ ëª¨ë“  ê¸€

```py
user.article_set.all
```

<br>

### 1:N (Article - Comment)

```py
ê°€ì¥ ë¨¼ì € ëª¨ë¸ ê´€ê³„ ì„¤ì •
ê²Œì‹œíŒì˜ ê²Œì‹œê¸€ê³¼ 1:N ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ëŒ“ê¸€ êµ¬í˜„
1:N ê´€ê³„ì—ì„œ ëŒ“ê¸€ì„ ë‹´ë‹¹í•  Article ëª¨ë¸ì€ 1, Comment ëª¨ë¸ì€ Nì´ ë  ê²ƒ
- ê²Œì‹œê¸€(1)ì€ ì—¬ëŸ¬ ê°œì˜ ëŒ“ê¸€(N)ì„ ê°€ì§„ë‹¤.
- ê²Œì‹œê¸€(1)ì€ ëŒ“ê¸€ì„ ê°€ì§€ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤.
- ëŒ“ê¸€ì€ í•˜ë‚˜ì˜ ê²Œì‹œê¸€ì— ì†í•œë‹¤.
```

- ForeignKey arguments - on_delete

```py
- ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ê°ì²´ê°€ ì‚¬ë¼ì¡Œì„ ë•Œ,
ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ì§€ë¥¼ ì •ì˜
- ë°ì´í„° ë¬´ê²°ì„±ì„ ìœ„í•´ì„œ ë§¤ìš° ì¤‘ìš”í•œ ì„¤ì •
```

- Comment ëª¨ë¸ ì •ì˜

```py
ì™¸ë˜ í‚¤ í•„ë“œëŠ” ForeignKey í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•˜ëŠ” ìœ„ì¹˜ì™€ ê´€ê³„ì—†ì´ í•„ë“œì˜ ë§ˆì§€ë§‰ì— ì‘ì„±ë¨
ForeignKey() í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ì´ë¦„ì€ ì°¸ì¡°í•˜ëŠ” ëª¨ë¸ í´ë˜ìŠ¤ ì´ë¦„ì˜ ë‹¨ìˆ˜í˜•(ì†Œë¬¸ì)ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥

class Comment(models.Model):
  content = models.TextField()
  created_at = models.DateTimeField(auto_now_add=True)
  article = models.ForeignKey(Article, on_delete=models.CASCADE) # Articleì´ ìœ„ì— ì •ì˜ë˜ì•¼ í•˜ëŠ”ë° ë§Œì•½ì— ìœ„ì—ì„œ ì •ì˜ í•  ìˆ˜ ì—†ìœ¼ë©´ ''ë¡œ ê°ì‹¸ì„œ ë¬¸ìë¡œ ì·¨ê¸‰ ê°€ëŠ¥
  ex)
  article = models.ForeignKey("Article", on_delete=models.CASCADE)
```

```py
# ê²Œì‹œê¸€ 13ë²ˆì— ë‚´ìš©ì´ 111ì¸ ëŒ“ê¸€ì„ ìƒì„±í•˜ëŠ” ì½”ë“œ
Comment.objects.create(content='111', article=article)
# Tì— ë¿Œë ¤ì£¼ë ¤ë©´
{% for comment in article.comment_set.all %}
{{ comment.content }}
{% endfor %}

# views.py
def comment_create(request, pk):
  article = Article.objects.get(pk=pk)
  comment_form = CommentForm(request.POST)
  if comment_form.is_valid():
    comment = comment_form.save(commit=False)
    comment.article = article
    comment.save()
  return redirect('articles:detail', article.pk)
```

## Commentê¸°ëŠ¥ ì •ë¦¬

1. ë¨¼ì € Comment Modelì„ ì •ì˜

```py
# models.py
class Comment(models.Model):
    content = models.TextField(max_length=80)
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    # articleì˜ Articleê³¼ on_delete=models.CASCADEë¥¼ ê°€ì§
```

2. ì •ì˜í•œ ëª¨ë¸ì„ ModelFormìœ¼ë¡œ ë„˜ê²¨ì¤Œ

```py
from .models import Comment

class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        fields = [
            "content",
        ]
```

3. ë©”ë§ˆë§ˆ(makemigration, migrate)

4. urls.py ì—ì„œ path ì •ì˜

```py
from . import views

app_name = "articles"

urlpatterns = [
  path("<int:pk>/comments/", views.comment_create, name="comment_create")
]
```

5. views.pyì—ì„œ comment_create ì •ì˜í•˜ê³ , ë‚´ìš©ì„ ë³´ë‚´ì£¼ê³  ì‹¶ì€ê³³ìœ¼ë¡œ redirect

```py
def comment_create(request, pk):
  article = Article.objects.get(pk=pk)
  comment_form = CommentForm(request.POST) # htmlì—ì„œ POSTë¡œ ì˜¨ ìš”ì²­ ë°›ìŒ
  if comment_form.is_vaild():
    comment = comment_form.save(commit=False)
    comment.article = article
    comment.save()
  return redirect("articles:detail", article.pk)
```

6. detail.htmlì—ì„œ ë°›ì•„ì˜¤ê¸°.

```html
<!-- ë¨¼ì € ì œì¶œí•  í¼ì„ ì„¤ì • -->
<form action="{% url 'articles:comment_create' article.pk %}" method="POST">
  {% csrf_token %} {% bootstrap_form comment_form layout="inline"%} {%
  bootstrap_button button_type="submit" content="OK" %}
</form>

{% for comment in comments %} {{ comment.content }} {% empty %}
<p>ëŒ“ê¸€ì´ ì—†ì–´ìš” ã… _ã… </p>
{% endfor %}
```

## Comment ì‚­ì œ ê¸°ëŠ¥ ì •ë¦¬

1. urlsì—ì„œ pathì„¤ì •

```py
# urls.py
path("<ind:article_pk>/comments/<int:comment_pk>/delete/", views.comment_delete, name="comment_delete",)
```

2. views.pyì—ì„œ def ì •ì˜

```py
# articel_pkì™€ comment_pkê°€ ë‘˜ë‹¤ í•„ìš”
def comment_delete(request, article_pk, comment_pk):
  Comment.objects.get(pk=comment_pk).delete() #pk=comment_pkê°€ ì¼ì¹˜í•˜ëŠ” ê²ƒì„ ì‚­ì œ
  return redirect("articles:detail", article_pk)
```

3. detail.htmlì—ì„œ ë Œë”ë§

```html
{% for comment in comments %} {{ comment.content }}
<!-- formì„ ì œì¶œí•  ë•Œ article.pkì™€ comment.pkë¥¼ ê°™ì´ ì œì¶œ -->
<form
  action="{% url 'articles:comment_delete' article.pk comment.pk %}"
  method="POST"
>
  {% csrf_token %}
  <input type="submit" value="DELETE" />
</form>
```

-

* ëŒ“ê¸€ ê°œìˆ˜ ì¶œë ¥í•˜ê¸°

```py
# DTL filter - length ì‚¬ìš©
{{ comments|length }}
# Queryset API - count() ì‚¬ìš©
{{ comments.count }}
{{ article.comment_set.count }}
```
