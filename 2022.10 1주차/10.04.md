# 10/4

# [Django] Django CRUD📝

## **Django란?** 💭

- 장고의 본질은 URL 요청을 받아서 처리하고 응답을 해주는 프레임워크
- 파이썬 기반의 프레임워크

### CRUD 기능💡

- CRUD를 만든다는 것은 데이터베이스를 조작하는 일
- UI(기능) / DB는 밀접한 관계

```py
1. Model 정의(DB 설계)
- 제목(20글자이내)
- 내용(긴 글)
- 글 작성시간/수정시간(자동으로 기록, 날짜/시간)

class Article(models.Model):
  title = model.CharField(max_length=20)
  content = models.TextField()
  created_at = model.DateTimeField(auto_now_add=True) # 생성시간
  Updated_at = model.DateTimeField(auto_now=True) # 업데이트시간


  1-2 모델을 만들고 migrations
  python manage.py migrations
  python manage.py migrate

2. Create 생성(게시글 생성)
- html의 form을 통해 사용자로부터 데이터를 입력 받아 전송
def create(request):
  title = request.GET.get('title')
  content = request.GET.get('title')
  Article.objects.create(title=title, content=content)
  return redirect('articles:index')

def index(request):
  # 게시글을 가져옴
  articles = Article.objects.all()
  # 역순
  # articles = Article.objects.order_by('-pk')
  # Template에 전달
  context = {
    'articles': articles
  }
  return render(request, 'articles/index.html', context)

2-1 index 페이지에서
{% for article in articles %}
  {{article.title}}
  {{article.created_at }} | {{ article.updated_at }}
{% endfor %}
-
```

### csrf_token💡

- 웹사이트 취약점 공격의 하나로, 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정, 삭제, 등록 등)를 특정 웹사이트에 요청하게 하는 공격

```py
{% csrf_token %}
```

### Django의 CSRF 공격에 대한 방어💡

- Django에서는 기본적으로 csrf token을 이용함

- POST 요청에 대해서만 csrf token을 발급하고 체크한다.

### 동작 과정💡

```py
1. 사용자가 해당 페이지에 접속하면 Django에서 자동으로 csrf_token을 클라이언트로 보내어 cookie에 저장
2. 사용자가 form을 모두 입력한 후 제출버튼을 클릭
3. form과 cookie의 csrf_token을 함께 POST로 전송
4. 전송된 token의 유효성을 검증
5. 유효한 요청이면 요청을 처리
  5-1. token이 유요하지 않거나(없거나 값이 잘못된 경우) 검증 오류 시에는 403 Forbidden Response반환
```

## **Django ModelForm** 💭

1. **개요**

- DB 기반의 어플리케이션을 개발하다보면, HTML Form은 Django의 모델과 매우 밀접한 관계를 가지게 됨
- 사용자가 입력한 값이 DB의 데이터 형식과 일치하는지를 확인하는 유효성 검증이 반드시 필요하며 이는 서버 사이드에서 반드시 처리해야 함
- **프론트단에 required만 포함하면 안되고, 서버단에서도 제한할 수 있는 처리가 필요**

```py
Model에 정의된 필드에 맞춰서
- UI
- 유효성 검사
- DB 저장
의 기능을 가짐
```

2. **forms.py**

```py
from django import forms
from .models import Article

class ArticleForm(forms.ModelForm):

  class Meta:
    model = Article
    fields = '__all__'
    # fields = ['title', 'content']
```

# ✅ Django 조작해보기

- **홀수 짝수**
  ![](./2022-09-26%20%EC%82%AC%EC%B9%99%EC%97%B0%EC%82%B0.gif)
- **사칙연산**
  ![](./2022-09-26%20%EC%82%AC%EC%B9%99%EC%97%B0%EC%82%B0.gif)
- **전생을 알려줘**
  ![](./2022-09-26%20%EC%A0%84%EC%83%9D%EC%9D%84%20%EC%95%8C%EB%A0%A4%EC%A4%98.gif)
- **로렘**
  ![](./2022-09-26%20%EB%A1%9C%EB%A0%98.gif)

## 🔎 내가 생각하는 중요한 기술

- Django에서 URL path 설정과 veiws에서의 함수 정의가 중요하다는 걸 알았다. 오타가 나지 않게 일치시키는게 중요하다.

- def 함수 안에서 다양한 기능을 구현할 수 있음을 느꼈다. html 페이지에서 form으로 제출하고 싶었는데 핸들링 하는 방법을 몰라서 애먹었다.

- 함수 끝부분에 render(request, 'html', context)를 통해서 결과 값을 html로 보내준다.

- context 안에 있는 키:벨류 값을 활용해서 html에서 {{ key값 }}을 넘겨주면 value값을 출력해준다. (키 값을 일치시켜야 한다.)

## 💎 느낀점

- Django 쪽으로 넘어오니 path 설정하는 것만 해도 익숙하지 않아 어렵다. 정말 api설정에 있어서 기본중의 기본인데 익숙해질 필요가 있어보인다.

- html에서 상속을 통해서 다른 html에도 동일한 view를 보여줄 수 있음을 알았다.

- React를 공부하고 있는데 Django와 React를 어떻게 결합해야할지 어느정도 감이 잡힌다.
