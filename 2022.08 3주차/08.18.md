# 8/18

# ğŸ•“ 9:00 ~ 6:00

## âœ… Database

### ê¸°ë³¸ í•¨ìˆ˜ì™€ ì—°ì‚°

```sql
ë¬¸ìì—´ í•¨ìˆ˜
SUBSTR: ë¬¸ìì—´ ìë¥´ê¸°
=> ì‹œì‘ ì¸ë±ìŠ¤ëŠ” 1, ë§ˆì§€ë§‰ ì¸ë±ìŠ¤ëŠ” -1
TRIM(ë¬¸ìì—´), LTRIM(ë¬¸ìì—´), RTRIM(ë¬¸ìì—´): ë¬¸ìì—´ ê³µë°± ì œê±°
LENGTH(ë¬¸ìì—´): ë¬¸ìì—´ ê¸¸ì´
REPLACE(ë¬¸ìì—´, íŒ¨í„´, ë³€ê²½ê°’): íŒ¨í„´ì— ì¼ì¹˜í•˜ëŠ” ë¶€ë¶„ì„ ë³€ê²½
UPPER(ë¬¸ìì—´), LOWER(ë¬¸ìì—´): ëŒ€ì†Œë¬¸ì ë³€ê²½
||: ë¬¸ìì—´ í•©ì¹˜ê¸°(concatenate)
```

### **ë¬¸ìì—´ (ì„±+ì´ë¦„) í•©ì³ì„œ 5ëª… ì¶œë ¥**

```sql
â€‹SELECT last_name || first_name
FROM users
LIMIT 5;
```

### **ë¬¸ìì—´ ê¸¸ì´ LENGTH**

```sql
SELECT LENGTH(first_name), first_name FROM users LIMIT 5;
```

### **ë¬¸ìì—´ REPLACE**

```sql
SELECT first_name, phone, REPLACE(phone, '-', '') FROM users LIMIT 5;
```

### **ìˆ«ì í™œìš©**

```sql
SELECT MOD(5, 2) FROM users LIMIT 1;

SELECT CEIL(3.14), FLOOR(3.14), ROUND(3.14)
FROM users
LIMIT 1;

SQRT ì œê³±ê·¼
POWER(9, 2) 9^2
```

## âœ… GROUP BY

```sql
SELECT ë¬¸ì˜ optional ì ˆ
í–‰ ì§‘í•©ì—ì„œ ìš”ì•½ í–‰ ì§‘í•©ì„ ë§Œë“¦
ì„ íƒëœ í–‰ ê·¸ë£¹ì„ í•˜ë‚˜ ì´ìƒì˜ ì—´ ê°’ìœ¼ë¡œ ìš”ì•½ í–‰ìœ¼ë¡œ ë§Œë“¦
ë¬¸ì¥ì— WHERE ì ˆì´ í¬í•¨ëœ ê²½ìš° ë°˜ë“œì‹œ WHERE ì ˆ ë’¤ì— ì‘ì„±í•´ì•¼ í•¨
SELECT * FROM users GROUP BY last_name;
```

### **usersì—ì„œ ê° ì„±(last_name)ì”¨ê°€ ëª‡ ëª…ì”© ìˆëŠ”ì§€ ì¡°íšŒí•œë‹¤ë©´?**

```sql
GROUP BY ì—ì„œ í™œìš©í•˜ëŠ” ì»¬ëŸ¼ì„ ì œì™¸í•˜ê³ ëŠ” ì§‘ê³„í•¨ìˆ˜ê°€ ìœ ë¦¬
GROUP BY ëŠ” ê²°ê³¼ê°€ ì •ë ¬ë˜ì§€ ì•ŠìŒ, ê¸°ì¡´ ìˆœì„œì™€ ë°”ë€œ
ì •ë ¬í•´ì„œ ë³´ê³  ì‹¶ìœ¼ë©´ ORDER BY

SELECT last_name, COUNT(*) FROM users GROUP BY last_name; last_name COUNT(*)
```

### **GROUP BY WHRERì„ ì“°ê³  ì‹¶ë‹¤ë©´**

```sql
100ë²ˆ ì´ìƒ ë“±ì¥í•œ ì„±ë§Œ ì¶œë ¥í•˜ê³  ì‹¶ë‹¤ë©´
(ì¡°ê±´ì— ë”°ë¥¸ GROUP í•˜ë ¤ë©´ HAVINGì„ ì“´ë‹¤)
SELECT last_name, COUNT(last_name)
FROM users
GROUP BY last_name
HAVING COUNT(last_name) > 100;
```

## âœ… SELECT ë¬¸ì¥ ì‹¤í–‰ ìˆœì„œ

### **ì§‘ê³„ í•¨ìˆ˜**

```SQL
FROM => WHERE => GROUP BY => HAVING => SELECT => ORDER BY
FROM í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ WHERE ì œì•½ì¡°ê±´ì— ë§ì¶°ì„œ ë½‘ì•„ì„œ
GROUP BY ê·¸ë£¹í™”í•œë‹¤.
HAVING ê·¸ë£¹ ì¤‘ì— ì¡°ê±´ê³¼ ë§ëŠ” ê²ƒë§Œì„
SELECT ì¡°íšŒí•˜ì—¬
ORDER BY ì •ë ¬í•˜ê³ 
LIMIT/ OFFSET íŠ¹ì • ìœ„ì¹˜ì˜ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
```

## âœ… ALTER TABLE

### **ALTER TABLE**

```sql
1. í…Œì´ë¸” ì´ë¦„ ë³€ê²½
ALTER TABLE tabel_name
RENAME TO new_name;

2. ìƒˆë¡œìš´ column ì´ë¦„ ì¶”ê°€
ALTER TABLE table_name
ADD COLUMN column_definition;

3. column ìˆ˜ì •
ALTER TABLE table_name
RENAME COLUMN current_name TO new_name:

4. column ì‚­ì œ
ALTER TABLE table_name
DROP COLUMN column_name;
```

## âœ… ORDER BY

```sql
ì¡°íšŒ ê²°ê³¼ ì§‘í•©ì„ ì •ë ¬
SELECT ë¬¸ì— ì¶”ê°€í•˜ì—¬ ì‚¬ìš©
ì •ë ¬ ìˆœì„œë¥¼ ìœ„í•œ 2ê°œì˜ keyword ì œê³µ
ASC - ì˜¤ë¦„ì°¨ìˆœ
DESC - ë‚´ë¦¼ì°¨ìˆœ

users ì—ì„œ ë‚˜ì´ ìˆœìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•˜ì—¬ ìƒìœ„ 10ê°œ ì¡°íšŒ
SELECT * FROM users ORDER BY age ASC LIMIT 10;
users ì—ì„œ ë‚˜ì´, ì„± ìˆœìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ
SELECT * FROM users ORDER BY age, last_name LIMIT 10;
ê³„ì¢Œ ì”ì•¡ ë‚´ë¦¼ì°¨ìˆœ(ë†’ì€->ë‚®ì€ ê²ƒ), ì„± ì˜¤ë¦„ì°¨ìˆœ(ã„±->ã…)
SELECT last_name, first_name, balance FROM users ORDER BY balance DESC, last_name ASC LIMIT 10;
```

## âœ… ì‹¤ìŠµ ë¬¸ì œ

# 3ì¼ì°¨ ì‹¤ìŠµ

### 1. í¡ì—° ì—¬ë¶€(smoking)ë¡œ êµ¬ë¶„í•œ ê° ê·¸ë£¹ì˜ ì»¬ëŸ¼ëª…ê³¼ ê·¸ë£¹ì˜ ì‚¬ëŒì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT smoking, COUNT(*) FROM healthcare WHERE smoking != '' GROUP BY smoking;
```

```sql
smoking  COUNT(*)
-------  --------------
1        626138
2        189808
3        183711
```

### 2. ìŒì£¼ ì—¬ë¶€(is_drinking)ë¡œ êµ¬ë¶„í•œ ê° ê·¸ë£¹ì˜ ì»¬ëŸ¼ëª…ê³¼ ê·¸ë£¹ì˜ ì‚¬ëŒì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT is_drinking, COUNT(*) FROM healthcare WHERE is_drinking != '' GROUP BY is_drinking;
```

```sql
is_drinking  COUNT(*)
-----------  ------------------
0            415119
1            584685
```

### 3. ìŒì£¼ ì—¬ë¶€ë¡œ êµ¬ë¶„í•œ ê° ê·¸ë£¹ì—ì„œ í˜ˆì••(blood_pressure)ì´ 200ì´ìƒì¸ ì‚¬ëŒì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT COUNT(blood_pressure) hypertension FROM healthcare WHERE blood_pressure>=200 GROUP BY is_drinking;
```

```sql
hypertension
------------
6064
1770
```

### 4. ì‹œë„(sido)ì— ì‚¬ëŠ” ì‚¬ëŒì˜ ìˆ˜ê°€ 50000ëª… ì´ìƒì¸ ì‹œë„ì˜ ì½”ë“œì™€ ê·¸ ì‹œë„ì— ì‚¬ëŠ” ì‚¬ëŒì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT sido, COUNT(sido) FROM healthcare GROUP BY sido HAVING COUNT(sido)>=50000;
```

```sql
sido  COUNT(sido)
----  -----------
11    166231
26    69025
28    58345
41    247369
47    54438
48    68530
```

### 5. í‚¤(height)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ êµ¬ë¶„í•˜ê³ , ê° í‚¤ì™€ ì‚¬ëŒì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

> ë‹¨, ì‚¬ëŒì˜ ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ 5ê°œê¹Œì§€ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT height, COUNT(height) FROM healthcare GROUP BY height ORDER BY COUNT(height) DESC LIMIT 5;
```

```sql
height  COUNT(height)
------  -------------
160     184993
155     181306
165     179352
170     152585
150     128555
```

### 6. í‚¤(height)ì™€ ëª¸ë¬´ê²Œ(weight)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ êµ¬ë¶„í•˜ê³ , ëª¸ë¬´ê²Œì™€, í‚¤, í•´ë‹¹ ê·¸ë£¹ì˜ ì‚¬ëŒì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

> ë‹¨, ì‚¬ëŒì˜ ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ 5ê°œê¹Œì§€ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT weight, height, COUNT(*) FROM healthcare GROUP BY height, weight ORDER BY COUNT(*) DESC LIMIT 5;
```

```sql
weight  height  COUNT(*)
------  ------  --------
55      155     45866
60      160     42454
65      165     40385
50      155     38582
55      160     38066
```

### 7. ìŒì£¼ì—¬ë¶€ì— ë”°ë¼ í‰ê·  í—ˆë¦¬ë‘˜ë ˆ(waist)ì™€ ì‚¬ëŒì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT ROUND(AVG(waist), 1) "í‰ê·  í—ˆë¦¬ë‘˜ë ˆ", COUNT(*) FROM healthcare GROUP BY is_drinking;
```

```sql
í‰ê·  í—ˆë¦¬ë‘˜ë ˆ  COUNT(*)
-------  --------
81.2     415119
83.2     584685
82.8     196
```

### 8. ê° ì„±ë³„(gender)ì˜ í‰ê·  ì™¼ìª½ ì‹œë ¥(va_left)ê³¼ í‰ê·  ì˜¤ë¥¸ìª½ ì‹œë ¥(va_right)ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

> ë‹¨, í‰ê·  ì™¼ìª½ ì‹œë ¥ê³¼ í‰ê·  ì˜¤ë¥¸ìª½ ì‹œë ¥ì˜ ì»¬ëŸ¼ëª…ì„ 'í‰ê·  ì™¼ìª½ ì‹œë ¥' 'í‰ê·  ì˜¤ë¥¸ìª½ ì‹œë ¥'ë¡œ í‘œì‹œí•˜ê³ , í‰ê·  ì‹œë ¥ì€ ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT gender, ROUND(AVG(va_left), 2) "í‰ê·  ì™¼ìª½ ì‹œë ¥", ROUND(AVG(va_right), 2) "í‰ê·  ì˜¤ë¥¸ìª½ ì‹œë ¥" FROM healthcare GROUP BY gender;
```

```sql
gender  í‰ê·  ì™¼ìª½ ì‹œë ¥  í‰ê·  ì˜¤ë¥¸ìª½ ì‹œë ¥
------  --------  ---------
1       0.98      0.99
2       0.88      0.88
```

### 9. ê° ë‚˜ì´ëŒ€(age)ì˜ í‰ê·  í‚¤ì™€ í‰ê·  ëª¸ë¬´ê²Œë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

> ë‹¨, í‰ê·  í‚¤ì™€ í‰ê·  ëª¸ë¬´ê²Œì˜ ì»¬ëŸ¼ëª…ì„ 'í‰ê·  í‚¤' 'í‰ê·  ëª¸ë¬´ê²Œ'ë¡œ í‘œì‹œí•˜ê³ , í‰ê· í‚¤ê°€ 160 ì´ìƒ í‰ê·  ëª¸ë¬´ê²Œê°€ 60 ì´ìƒì¸ ë°ì´í„°ë§Œ ì¶œë ¥í•˜ì‹œì˜¤.

```sql
SELECT age, ROUND(AVG(height), 1) "í‰ê·  í‚¤", ROUND(AVG(weight), 1) "í‰ê·  ëª¸ë¬´ê²Œ" FROM healthcare GROUP BY age HAVING "í‰ê·  í‚¤">=160 AND "í‰ê·  ëª¸ë¬´ê²Œ">=60;
```

```sql
age  í‰ê·  í‚¤   í‰ê·  ëª¸ë¬´ê²Œ
---  -----  ------
9    165.7  67.2
10   164.1  65.7
11   162.1  63.9
12   160.7  62.6
```

### 10. ìŒì£¼ ì—¬ë¶€(is_drinking)ì™€ í¡ì—° ì—¬ë¶€(smoking)ì— ë”°ë¥¸ í‰ê·  BMIë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.

> ë‹¨, ìŒì£¼ ì—¬ë¶€ ë˜ëŠ” í¡ì—° ì—¬ë¶€ê°€ ê³µë°±ì´ ì•„ë‹Œ í–‰ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.

```sql
SELECT is_drinking, smoking, AVG(weight/(height*height*0.0001)) AVG_BMI FROM healthcare WHERE is_drinking != '' and smoking != ''GROUP BY is_drinking, smoking;
```

```sql
is_drinking  smoking  AVG_BMI
-----------  -------  ----------------
0            1        23.8724603942955
0            2        24.6073677352564
0            3        24.3193273448558
1            1        23.9341328992508
1            2        25.0333550564281
1            3        24.6363247421328
```
