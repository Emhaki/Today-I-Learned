# 10/12

# [Django] Django íšŒì›ê°€ì…/ë¡œê·¸ì¸ğŸ“

## **ê²Œì‹œíŒê³¼ íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì°¨ì´ì ** ğŸ’­

- ê²Œì‹œê¸€ì€ ê·¸ëŒ€ë¡œ ë³´ì—¬ì¤˜ë„ ë˜ì§€ë§Œ, ë¹„ë°€ë²ˆí˜¸ëŠ” ì•”í˜¸í™”(í•´ì‹œí™”)ë¥¼ í•´ì•¼ í•¨

### AuthğŸ’¡

- Django authentication system(ì¸ì¦ ì‹œìŠ¤í…œ)ì€ ì¸ì¦(Authentication)ê³¼ ê¶Œí™˜(Autohrization)ë¶€ì—¬ë¥¼ í•¨ê»˜ ì œê³µí•˜ê³  ìˆìŒ
- Users
- ê¶Œí•œ ë° ê·¸ë£¹
- Form ë° View ë„êµ¬
- í•„ìˆ˜ êµ¬ì„±ì€ Settings.pyì˜ INSTALLED_APPSì—ì„œ í™•ì¸ ê°€ëŠ¥
  - django.contrib.auth

### Django Auth ê°œìš”ğŸ’¡

- Authentication (ì¸ì¦)
- Authorization (ê¶Œí•œ, í—ˆê°€)
  - ê¶Œí•œ ë¶€ì—¬
  - ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‘ì—…ì„ ê²°ì •

```py
python manage.py startapp accounts

# settings.py
INSTALL_APPS = [
  'articles',
  'accounts',
]
```

### Django User modelğŸ’¡

- Django ê³µì‹ë¬¸ì„œì—ì„œ ë§ì€ attrië¥¼ í™•ì¸ê°€ëŠ¥.
- https://docs.djangoproject.com/en/4.1/topics/auth/default/

```py
DjangoëŠ” ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ëŠ” ê²½ìš° ë¹„ë¡ ê¸°ë³¸ user ëª¨ë¸ì´ ì¶©ë¶„í•˜ë”ë¼ë„
ì»¤ìŠ¤í…€ User ëª¨ë¸ì„ ì„¤ì •í•˜ëŠ” ê²ƒì„ "ê°•ë ¥í•˜ê²Œ ê¶Œì¥"

ì»¤ìŠ¤í…€ User ëª¨ë¸ì€ ê¸°ë³¸ User ëª¨ë¸ê³¼ ë™ì¼í•˜ê²Œ ì‘ë™ í•˜ë©´ì„œë„
í•„ìš”í•œ ê²½ìš° ë‚˜ì¤‘ì— ë§ì¶¤ ì„¤ì •í•  ìˆ˜ ìˆê¸° ë•Œë¬¸
```

### AUTH_USER_MODELğŸ’¡

```py
# setting.py

AUTH_USER_MODEL = 'accounts.User'

# models.py
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
  pass
```

### User ëª¨ë¸ ìƒì† ê´€ê³„ğŸ’¡

```py
models.Model => class AbstracBaseUser => class AbstractUser => class User
```

## **ì•”í˜¸ê´€ë¦¬** ğŸ’­

1. **Djangoì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ PBKDF2ë¥¼ ì‚¬ìš©í•˜ì—¬ ì €ì¥**

- ë‹¨ë°©í–¥ í•´ì‹œí•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì´ì œìŠ¤íŠ¸ë¡œ ì•”í˜¸í™”í•˜ë©°, ì´ëŠ” ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•¨

- ë‹¨ë°©í–¥ í•´ì‹œí•¨ìˆ˜ì˜ ê²½ìš° ë ˆì¸ë³´ìš° ê³µê²© ë° ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²© ë“±ì˜ ë¬¸ì œê°€ ë°œìƒ ê°€ëŠ¥í•¨

- ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•˜ì—¬ ì•„ë˜ì˜ ê¸°ë²•ì„ ì¶”ê°€ì ìœ¼ë¡œ í™œìš©í•¨
  - ì†”íŒ…: íŒ¨ìŠ¤ì›Œë“œì— ì„ì˜ì˜ ë¬¸ìì—´ì¸ saltë¥¼ ì¶”ê°€í•˜ì—¬ ë‹¤ì´ì œìŠ¤íŠ¸ë¥¼ ìƒì„±
  - í‚¤ ìŠ¤íŠ¸ë ˆì¹­: í•´ì‹œë¥¼ ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•˜ì—¬ ì‹œê°„ì„ ëŠ˜ë¦¼

2. **ë¹„ë°€ë²ˆí˜¸ ìƒì„± ë° í™•ì¸**

```py
User.objects.create_user('hong', 'hong@gmail.com', '1q2w3r')

User.objects.create_user('kim', 'hong@gmail.com','1234')
# ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸ ì—¬ë¶€
from django.contrib.auth import authenticate

authenticate(username='kim', password='1234')
```

## **íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„** ğŸ’­

```py
# urls.py
from django.urls import path
from . import views

app_name = 'accounts'

urlpatterns = [
    path('signup/', views.signup, name='signup')
  ]

# views.py
from django.shortcuts import render
# from django.contrib.auth.forms import UserCreationForm
from .forms import CustomUserCreationForm

def signup(request):

  if request.method == 'POST':
    # UserCreationFormì´ í•µì‹¬
    form = UserCreationForm(request.POST) # CustomUserCreationForm
      if form.is_valid():
        form.save()
        return redirect( 'articles:index' )
  else:
    form = UserCreationForm() # CustomUserCreationForm
  context = {
    'form': form
  }

  return render(request, 'accounts/signup.html', context)

# forms.py
from django.contrib.auth.forms import UserCreationForm
from .models import User

class CustomUserCreationForm(UserCreationForm):

  class Meta:
    model = User
    # fields = '__all__'
    fields = ('username',)

# admin.py
from django.contrib import admin
from .models import User

admin.site.register(User)
```

### í”„ë¡œí•„ í˜ì´ì§€ë¥¼ ë§Œë“ ë‹¤ë©´?ğŸ’¡

```py
1. URL ì„¤ì •
2. View
3. Template ë°˜í™˜
```

# âœ… Django ê³µë¶€

https://docs.djangoproject.com/en/4.1/topics/auth/default/

## **ë¬¸ì„œ ê³µë¶€** ğŸ’­

- Creating users

```py
from django.contrib.auth.models import User
user = User.objects.create_user('john', 'lemmon@thebeatles.com', 'johnpassword')

# if i want to change other fields.
user.last_name = 'Lennon'
user.save()
```

- Creating superusers

```py
# Crate superusers using the createsuperuser command:
python manage.py createsuperuser --usename=emhaki=mhmh779@naver.com
```

- Changing passwordss

```py
from django.contrib.auth.models import User
u = User.objects.get(username='emhaki')
u.set_password('new password')
u.save()
```

- Authenticating users

```py
from django.contrib.auth import authenticate
user = authenticate(username='john', password='secret')
if user is not None:
  # A backend authenticated the credentials
else:
  # No backend authenticated the credentials
```

## **django.contrib.auth** ğŸ’­

```py
- User model
  - Fields

- Attributes
  - is_authenticated
  - is_anonymous

- Methods
  - get_username()
  - get_full_name()
  - get_short_name()
  - set_password(raw_password)
  - check_password(raw_password)
  - set_unusable_password()

- Manager methods
  - create_user(username, email=None, password=None, **extra_fields)
  - create_superuser(username, email=None, password=None)
```

## **Customizing authentication in Django** ğŸ’­

```py
# Extending the existing User model
from django.contrib.auth.models import User

class Employee(models.Model):
  user = models.OneToOneField(User, on_delete=models.CASCADE)
  department = models.CharField(max_length=100)
```

```py
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as BaseUserAdmin
from django.contrib.auth.models import User

from my_user_profile_app.models import Employee

class EmployeeInline(admin.StackedInlin):
  model = Employee
  can_delete = False
  verbose_name_plural = 'employee'

class UserAdmin(BaseUserAdmin):
  inlines = (EmployeeInline,)

admin.site.unregister(User)
admin.site.register(User, UserAdmin)
```

## **Password management in Django** ğŸ’­

```py
# Djangoì—ì„œì˜ íŒ¨ìŠ¤ì›Œë“œ ë¡œì§
<algorithm>$<iterations>$<salt>$<hash>
```

```py
# Default Password_hashers
PASSWORD_HASHERS = [
    'django.contrib.auth.hashers.PBKDF2PasswordHasher',
    'django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher',
    'django.contrib.auth.hashers.Argon2PasswordHasher',
    'django.contrib.auth.hashers.BCryptSHA256PasswordHasher',
]
```

## **Django CRUD ê³¼ì •** ğŸ’­

1. ê°€ìƒí™˜ê²½ ìƒì„± ë° ì‹¤í–‰

```py
python -m venv venv
source venv/Scripts/activate
```

- Django ì„¤ì¹˜ ë° ê¸°ë¡

```py
pip install django==3.2.13
pip freeze > requirements.txt
```

- Django í”„ë¡œì íŠ¸ ìƒì„±

```py
django-admin startproject pjt .
```

2. articles app ìƒì„±

```py
python manage.py startapp app_name

# settings.py íŒŒì¼ì˜ INSTALLED_APPSì— ì¶”ê°€
INSTALLED_APPS = [
  'articles,
  ...
]

# urls.py ì„¤ì •
urlpattens = [
  ...
  path('articles/', include('articles.urls'))
]

# articles/urls.py
from django.urls import path
from . import views

app_name = 'articles'

urlpatterns = [
  path('', views.index, name='index'),
  ...
]

{% url 'ì•±ë„¤ì„:(path name)index'%}
```

3. Model ì •ì˜ (DB ì„¤ê³„)

- í´ë˜ìŠ¤ ì •ì˜

```py
class Article(models.Model):
  title = models.CharField(max_length=20)
  content = models.TextField()
  created_at = models.DateTimeField(auto_now_add=True)
  updated_at = models.DateTimeField(auto_now=Ture)
```

- ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±

```py
python manage.py makemigrations
```

- DBë°˜ì˜(migrate)

```py
python manage.py migrate
```

4. CRUD ê¸°ëŠ¥ êµ¬í˜„

- ModelForm ì„ ì–¸

```py
from django import forms
from .models import Article

class ArticleForm(forms.ModelForm):

  class Meta:
    model = Article
    fields = ['title', 'content']
```

- ê²Œì‹œê¸€ ìƒì„±

```py
# views.py

def create(request):
  article_form = ArticleForm()
  context = {
    'article_form': article_form
  }
  return render(request, 'articles/create.html', context=context)

#create.html
<h1>ê¸€ì“°ê¸°</h1>
<form action="" method="POST">
  {% csrf_token %}
  {{ article_form.as_p }}
  <input type="submit" value="ê¸€ì“°ê¸°">
</form>
```

```py
# ë³€ê²½
def create(request):
  if request.method == 'POST':
    article_form = ArticleForm(request.POST)
    if article_form.is_valid()
      article_form.save()
      return redirect('articles:index')
  else:
    article_form = ArticleForm()
  context = {
    'article_form': article_form
  }
  return render(request, 'articles/new.html', context=context)
```
